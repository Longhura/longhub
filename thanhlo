getgenv().Extend_NPC_Ennemy_Hitbox = false
getgenv().FlyMode = false
getgenv().LuckyMode = false
getgenv().HeadCollisionMode = false -- M·∫∑c ƒë·ªãnh ƒë·∫ßu kh√¥ng c√≥ va ch·∫°m

local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")
local camera = Workspace.CurrentCamera

-- üìå T·∫°o GUI ƒë·∫πp h∆°n
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.ResetOnSpawn = false

local function createButton(name, position, color, text)
    local btn = Instance.new("TextButton", ScreenGui)
    btn.Name = name
    btn.Size = UDim2.new(0, 120, 0, 50)
    btn.Position = position
    btn.BackgroundColor3 = color
    btn.Text = text
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Active = true
    btn.Draggable = true
    btn.AutoButtonColor = false
    btn.BorderSizePixel = 0
    -- üåü Hi·ªáu ·ª©ng hover
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 255, 100)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = color}):Play()
    end)
    return btn
end

-- üü¢ N√∫t ti√™u di·ªát NPC
local KillButton = createButton("KillNPC", UDim2.new(0.3, 0, 0.3, 0), Color3.fromRGB(255, 0, 0), "OFF (NPC)")

-- üîµ N√∫t bay
local FlyButton = createButton("Fly", UDim2.new(0.3, 0, 0.4, 0), Color3.fromRGB(255, 140, 0), "OFF (Fly)")

-- üéØ Ti√™u di·ªát NPC trong ph·∫°m vi 200 studs
local function KillNPCs()
    RunService.Heartbeat:Connect(function()
        if getgenv().Extend_NPC_Ennemy_Hitbox then
            for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                local hrp = enemy:FindFirstChild("HumanoidRootPart")
                local humanoid = enemy:FindFirstChildOfClass("Humanoid")
                local head = enemy:FindFirstChild("Head") -- üß† L·∫•y ƒë·∫ßu NPC

                if hrp and humanoid and humanoid.Health > 0 then
                    local distance = (character.HumanoidRootPart.Position - hrp.Position).Magnitude
                    if distance <= 200 then -- ‚ö†Ô∏è Ph·∫°m vi 200
                        -- üî¥ M·ªü r·ªông hitbox
                        hrp.Size = Vector3.new(75, 75, 75)
                        hrp.Transparency = 0.85
                        hrp.CanCollide = false
                        humanoid.Health = 0 -- üíÄ Ti√™u di·ªát NPC

                        -- üß† Ph√≥ng to ƒë·∫ßu NPC
                        if head then
                            head.Size = Vector3.new(head.Size.X * 10, head.Size.Y * 10, head.Size.Z * 10)
                            head.Transparency = 0.9
                        end
                    end
                end
            end
        end
    end)
end

-- ‚úàÔ∏è H·ªá th·ªëng bay
local flySpeed = 150
local flying = false
local bodyVelocity = Instance.new("BodyVelocity")
bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
bodyVelocity.Velocity = Vector3.new(0, 0, 0)

local function FlyControl()
    if flying then return end
    flying = true
    bodyVelocity.Parent = humanoidRootPart

    RunService.RenderStepped:Connect(function()
        if not getgenv().FlyMode or humanoid:GetState() == Enum.HumanoidStateType.Stunned then
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
            bodyVelocity.Parent = nil
            flying = false
            return
        end

        -- üïπÔ∏è ƒêi·ªÅu khi·ªÉn bay theo g√≥c nh√¨n
        if humanoid.MoveDirection.Magnitude > 0 then
            local camDirection = camera.CFrame.LookVector
            local moveDir = camDirection * flySpeed

            -- ‚è´ ƒêi·ªÅu khi·ªÉn l√™n/xu·ªëng b·∫±ng g√≥c nh√¨n
            local _, pitch = camera.CFrame:ToEulerAnglesYXZ()
            local upDownSpeed = pitch * flySpeed

            -- üöÄ Gi·ªØ Shift ƒë·ªÉ tƒÉng t·ªëc
            if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then
                moveDir = moveDir * 1.5
            end

            -- C·∫≠p nh·∫≠t v·∫≠n t·ªëc bay
            bodyVelocity.Velocity = moveDir + Vector3.new(0, upDownSpeed, 0)
        else
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        end
    end)
end

-- üéõÔ∏è B·∫≠t/t·∫Øt ti√™u di·ªát NPC
KillButton.MouseButton1Click:Connect(function()
    getgenv().Extend_NPC_Ennemy_Hitbox = not getgenv().Extend_NPC_Ennemy_Hitbox

    if getgenv().Extend_NPC_Ennemy_Hitbox then
        KillButton.Text = "ON (NPC)"
        TweenService:Create(KillButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 255, 0)}):Play()
    else
        KillButton.Text = "OFF (NPC)"
        TweenService:Create(KillButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 0, 0)}):Play()
    end
end)

-- ‚úàÔ∏è B·∫≠t/t·∫Øt bay
FlyButton.MouseButton1Click:Connect(function()
    getgenv().FlyMode = not getgenv().FlyMode

    if getgenv().FlyMode then
        FlyButton.Text = "ON (Fly)"
        TweenService:Create(FlyButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(0, 191, 255)}):Play()
        FlyControl()
    else
        FlyButton.Text = "OFF (Fly)"
        TweenService:Create(FlyButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 140, 0)}):Play()
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = nil
        flying = false
    end
end)

-- üéØ T√≠nh nƒÉng ph√≥ng to ƒë·∫ßu NPC
local function ResizeHead(scale)
    local head = character:FindFirstChild("Head")
    if head then
        head.Size = Vector3.new(head.Size.X * scale, head.Size.Y * scale, head.Size.Z * scale)
    end
end

-- üé∞ T√≠nh nƒÉng Lucky
local function LuckyMode()
    getgenv().LuckyMode = not getgenv().LuckyMode

    if getgenv().LuckyMode then
        RunService.Heartbeat:Connect(function()
            for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                local head = enemy:FindFirstChild("Head")
                if head and (character.HumanoidRootPart.Position - head.Position).Magnitude <= 10 then
                    head.Size = Vector3.new(head.Size.X * 100, head.Size.Y * 100, head.Size.Z * 100)
                end
            end
        end)
    end
end

-- üéÆ X·ª≠ l√Ω chat commands
player.Chatted:Connect(function(message)
    if message == "/head" then
        ResizeHead(1) -- Tr·∫£ v·ªÅ k√≠ch th∆∞·ªõc m·∫∑c ƒë·ªãnh
    elseif message == "/100" then
        ResizeHead(100) -- Ph√≥ng to ƒë·∫ßu 100 l·∫ßn
    elseif message == "/10" then
        ResizeHead(10) -- Ph√≥ng to ƒë·∫ßu 10 l·∫ßn
    elseif message == "/lucky" then
        LuckyMode() -- B·∫≠t/t·∫Øt t√≠nh nƒÉng Lucky
    elseif message == "/mode0" then
        getgenv().HeadCollisionMode = false
        local head = character:FindFirstChild("Head")
        if head then
            head.CanCollide = false -- T·∫Øt va ch·∫°m
        end
    elseif message == "/mode1" then
        getgenv().HeadCollisionMode = true
        local head = character:FindFirstChild("Head")
        if head then
            head.CanCollide = true -- B·∫≠t va ch·∫°m
        end
    end
end)

KillNPCs()
