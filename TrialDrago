local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

local Player = Players.LocalPlayer
local ScreenGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local UIStroke = Instance.new("UIStroke")

-- T·∫°o c√°c n√∫t
local TeleportTrialButton = Instance.new("TextButton")
local TeleportBrazierButton = Instance.new("TextButton")
local TeleportDoorButton = Instance.new("TextButton")
local LampButton = Instance.new("TextButton")
local CloseButton = Instance.new("TextButton")
local ResetButton = Instance.new("TextButton") -- N√∫t "üîì"

ScreenGui.Parent = Player:WaitForChild("PlayerGui")
ScreenGui.Name = "TeleportGUI"
ScreenGui.ResetOnSpawn = false

Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(33, 33, 33)
Frame.Position = UDim2.new(0.5, -90, 0.5, -75)
Frame.Size = UDim2.new(0, 180, 0, 180)
Frame.Active = true
Frame.Draggable = true

-- Vi·ªÅn c·∫ßu v·ªìng
UIStroke.Parent = Frame
UIStroke.Thickness = 3
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

-- Danh s√°ch m√†u c·∫ßu v·ªìng
local colors = {
    Color3.fromRGB(255, 0, 0),   -- ƒê·ªè
    Color3.fromRGB(255, 127, 0), -- Cam
    Color3.fromRGB(255, 255, 0), -- V√†ng
    Color3.fromRGB(0, 255, 0),   -- Xanh l√°
    Color3.fromRGB(0, 255, 255), -- Xanh d∆∞∆°ng nh·∫°t
    Color3.fromRGB(0, 0, 255),   -- Xanh d∆∞∆°ng
    Color3.fromRGB(139, 0, 255)  -- T√≠m
}

-- Hi·ªáu ·ª©ng ƒë·ªïi m√†u vi·ªÅn
local function cycleRainbow()
    local index = 1
    while ScreenGui.Parent do
        local nextColor = colors[index]
        local tween = TweenService:Create(UIStroke, TweenInfo.new(0.5, Enum.EasingStyle.Linear), { Color = nextColor })
        tween:Play()
        tween.Completed:Wait()
        index = index % #colors + 1
    end
end

-- H√†m t·∫°o n√∫t
local function createButton(button, parent, text, position, color)
    button.Parent = parent
    button.Text = text
    button.Position = position
    button.Size = UDim2.new(0.8, 0, 0.18, 0)
    button.Font = Enum.Font.SourceSansBold
    button.TextSize = 18
    button.BackgroundColor3 = color
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.BorderSizePixel = 0
end

-- T·∫°o n√∫t trong khung
createButton(TeleportTrialButton, Frame, "L·ªëi V√†o", UDim2.new(0.1, 0, 0.1, 0), Color3.fromRGB(0, 255, 0))
createButton(TeleportBrazierButton, Frame, "Tr·ª• Cao", UDim2.new(0.1, 0, 0.3, 0), Color3.fromRGB(255, 165, 0))
createButton(LampButton, Frame, "ƒê√®n1", UDim2.new(0.1, 0, 0.5, 0), Color3.fromRGB(0, 170, 255))
createButton(TeleportDoorButton, Frame, "L·ªëi Ra", UDim2.new(0.1, 0, 0.7, 0), Color3.fromRGB(255, 0, 0))

-- N√∫t ƒë√≥ng (X)
CloseButton.Parent = Frame
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -30, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.SourceSansBold
CloseButton.TextSize = 18
CloseButton.BorderSizePixel = 0
CloseButton.ZIndex = 2

-- N√∫t Reset (üîì)
ResetButton.Parent = Frame
ResetButton.Size = UDim2.new(0, 25, 0, 25)
ResetButton.Position = UDim2.new(0, 5, 0, 5)
ResetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
ResetButton.Text = "üîì"
ResetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResetButton.Font = Enum.Font.SourceSansBold
ResetButton.TextSize = 18
ResetButton.BorderSizePixel = 0
ResetButton.ZIndex = 2

-- Hi·ªáu ·ª©ng hover cho n√∫t ƒë√≥ng
CloseButton.MouseEnter:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
end)
CloseButton.MouseLeave:Connect(function()
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
end)

-- Hi·ªáu ·ª©ng hover cho n√∫t Reset
ResetButton.MouseEnter:Connect(function()
    ResetButton.BackgroundColor3 = Color3.fromRGB(50, 180, 255)
end)
ResetButton.MouseLeave:Connect(function()
    ResetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
end)

-- H√†m t√¨m ƒë·ªëi t∆∞·ª£ng g·∫ßn nh·∫•t
local function findNearestObject(objectName)
    local character = Player.Character
    if not character or not character.PrimaryPart then
        return nil
    end

    local nearestObject = nil
    local shortestDistance = math.huge
    local characterPosition = character.PrimaryPart.Position

    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Name == objectName then
            local distance = (obj.Position - characterPosition).Magnitude
            if distance < shortestDistance then
                nearestObject = obj
                shortestDistance = distance
            end
        end
    end

    return nearestObject
end

-- H√†m d·ªãch chuy·ªÉn
local function teleportToObject(objectName)
    local target = findNearestObject(objectName)
    if target then
        local character = Player.Character
        if character and character.PrimaryPart then
            character:SetPrimaryPartCFrame(CFrame.new(target.Position))
        end
    end
end

-- H√†m t√¨m t·∫•t c·∫£ "Color4" v√† s·∫Øp x·∫øp theo kho·∫£ng c√°ch
local function getSortedColorList()
    local character = Player.Character
    if not character or not character.PrimaryPart then
        return {}
    end

    local colorList = {}

    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("BasePart") and obj.Name == "Color4" then
            local distance = (obj.Position - character.PrimaryPart.Position).Magnitude
            table.insert(colorList, { obj = obj, distance = distance })
        end
    end

    table.sort(colorList, function(a, b) return a.distance < b.distance end)

    return colorList
end

-- D·ªØ li·ªáu v√≤ng l·∫∑p "ƒê√®n"
local lampIndex = 1
local visitedColors = {}

-- H√†m d·ªãch chuy·ªÉn ƒë·∫øn "Color4" ch∆∞a gh√© qua trong v√≤ng l·∫∑p hi·ªán t·∫°i
local function teleportToNextColor()
    local colorList = getSortedColorList()
    if #colorList == 0 then return end

    -- L·ªçc ra nh·ªØng Color4 ch∆∞a ƒë·∫øn
    local unvisitedColors = {}
    for _, colorData in ipairs(colorList) do
        if not visitedColors[colorData.obj] then
            table.insert(unvisitedColors, colorData.obj)
        end
    end

    -- N·∫øu ƒë√£ ƒëi qua t·∫•t c·∫£, reset v√≤ng l·∫∑p
    if #unvisitedColors == 0 then
        visitedColors = {}
        lampIndex = 1
        LampButton.Text = "ƒê√®n1"
        return
    end

    -- D·ªãch chuy·ªÉn ƒë·∫øn Color4 g·∫ßn nh·∫•t trong danh s√°ch ch∆∞a ƒë·∫øn
    local targetColor = unvisitedColors[1]
    visitedColors[targetColor] = true

    local character = Player.Character
    if character and character.PrimaryPart then
        character:SetPrimaryPartCFrame(targetColor.CFrame + Vector3.new(0, 3, 0))
    end

    -- C·∫≠p nh·∫≠t n√∫t ƒê√®n
    lampIndex = lampIndex % 3 + 1
    LampButton.Text = "ƒê√®n" .. lampIndex
end

-- G√°n ch·ª©c nƒÉng d·ªãch chuy·ªÉn cho n√∫t
TeleportTrialButton.MouseButton1Click:Connect(function()
    teleportToObject("TrialTeleport")
end)

TeleportBrazierButton.MouseButton1Click:Connect(function()
    teleportToObject("Brazier2")
end)

TeleportDoorButton.MouseButton1Click:Connect(function()
    teleportToObject("DoorTouch")
end)

-- N√∫t ƒê√®n ho·∫°t ƒë·ªông theo v√≤ng l·∫∑p "ƒê√®n1 ‚Üí ƒê√®n2 ‚Üí ƒê√®n3 ‚Üí Reset"
LampButton.MouseButton1Click:Connect(teleportToNextColor)

-- N√∫t ƒë√≥ng GUI
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- N√∫t Reset: Xo√° to√†n b·ªô d·ªØ li·ªáu l∆∞u tr·ªØ ƒëi·ªÉm tr∆∞·ªõc ƒë√≥
ResetButton.MouseButton1Click:Connect(function()
    visitedColors = {}
    lampIndex = 1
    LampButton.Text = "ƒê√®n1"
end)

-- Ch·∫°y hi·ªáu ·ª©ng vi·ªÅn c·∫ßu v·ªìng
task.spawn(cycleRainbow)
